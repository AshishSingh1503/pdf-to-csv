# ==============================================
# PRODUCTION ENVIRONMENT CONFIGURATION
# Optimized for: 4 vCPUs, ~20 hours/month usage
# Budget Goal: < $230/month
# ==============================================

NODE_ENV=production
PORT=5000
LOG_LEVEL=info
WS_PATH=/ws

# --- Google Cloud Resources ---
PROJECT_ID=pdf2csv-475708
LOCATION=us
PROCESSOR_ID=ac7cd16151a4efbe

# Credentials:
# In Cloud Run, we use "Application Default Credentials" (ADC).
# This means no key file is needed; the service uses the attached Service Account directly.
# GOOGLE_APPLICATION_CREDENTIALS=/app/config/pdf2csv-475708-40fcbfdf2e46.json

# --- Database (Cloud SQL) ---
# Connect via Unix socket for best performance and security in Cloud Run.
DB_HOST=/cloudsql/pdf2csv-475708:us-central1:pdf2csv-new
DB_PORT=5432
DB_NAME=pdf2csv_new_db
DB_USER=pdf2csv_app_user
DB_PASSWORD=AppUser2024!
DB_SSL=false

# Connection Pooling:
# For ~20 hours usage with 4 vCPUs, you don't need 500 connections.
# Lowering this saves memory on the Cloud SQL instance (allowing you to use a smaller/cheaper tier like db-f1-micro or db-g1-small).
# Recommended: 20-50 max connections.
DB_POOL_MAX=50
DB_POOL_MIN=2
DB_INSERT_CHUNK_SIZE=5000

# --- Frontend & CORS ---
ALLOWED_ORIGINS=https://pdf2csv-frontend-805037964827.us-central1.run.app
CLIENT_URL=https://pdf2csv-frontend-805037964827.us-central1.run.app
VITE_API_URL=https://pdf2csv-backend-805037964827.us-central1.run.app
VITE_WS_URL=wss://pdf2csv-backend-805037964827.us-central1.run.app

# --- Performance & Cost Tuning (4 vCPUs) ---

# Worker Threads:
# You have 4 vCPUs. Setting this too high causes "context switching" overhead.
# Recommended: Equal to vCPU count (4) or slightly higher (6) to handle I/O waits.
WORKER_THREAD_POOL_SIZE=4

# Max Workers (Parallel File Processing):
# Controls how many PDF files are processed in parallel.
# Recommended: Keep close to vCPU count to avoid memory exhaustion.
MAX_WORKERS=8

# Document AI Concurrency:
# Controls how many requests we send to Google at once.
# Cost Impact: High concurrency finishes jobs faster (less Cloud Run runtime cost) but requires higher quotas.
# Document AI is billed per page, so speed doesn't increase price, but faster = less Cloud Run bill.
# Recommended: 80-100 is a sweet spot for 4 vCPUs.
MAX_CONCURRENT_DOCAI_REQUESTS=80

# Batch Processing:
# How many uploaded batches to process simultaneously.
# Keep this low to ensure each batch gets enough CPU.
MAX_CONCURRENT_BATCHES=5

# Timeouts:
# 30 minutes (1800000 ms) is generous for large batches.
BATCH_QUEUE_TIMEOUT=1800000

# Average Batch Time:
# Used for progress estimation. 150 seconds is a safe average.
AVERAGE_BATCH_SECONDS=150

# --- Queue Management ---
ENABLE_QUEUE_LOGGING=false
MAX_QUEUE_LENGTH=500
ENABLE_GRACEFUL_SHUTDOWN=true
GRACEFUL_SHUTDOWN_TIMEOUT=300000

# --- Storage (GCS) ---
OUTPUT_BUCKET=pdf-data-extraction-output-bucket
STORAGE_LOCATION=us
# Cost Saving: Set to 'true' to delete raw PDFs after processing to save storage costs.
# Set to 'false' if you want to keep a backup of every uploaded file.
DELETE_RAW_AFTER_PROCESS=false

OUTPUT_DIR=output
CSV_FILENAME=extracted_data.csv
EXCEL_FILENAME=extracted_data.xlsx

# --- Features ---
ENABLE_DUPLICATE_DETECTION=true
DUPLICATE_KEY_FIELD=mobile
CACHE_TTL=300